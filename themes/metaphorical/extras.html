<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>6. Дополнительные материалы</title>
<link rel="stylesheet" type="text/css" href="C.css">
<script type="text/javascript" src="jquery.js"></script><script type="text/javascript" src="jquery.syntax.js"></script><script type="text/javascript" src="yelp.js"></script>
</head>
<body><div class="page" role="main">
<div class="header"><div class="trails" role="navigation"><div class="trail">
<a class="trail" href="index.html" title="ГИС-Платформа"><span class="media"><span class="media media-image"><img src="figures_common/logo_mini.png" class="media media-inline" alt=""></span></span></a> » </div></div></div>
<div class="body">
<div class="hgroup"><h1 class="title"><span class="title">6. Дополнительные материалы</span></h1></div>
<div class="region">
<div class="contents"><div class="desc">Раздел содержит отдельные дополнительные материалы, не вошедшие в предыдущие разделы.</div></div>
<div id="hunity" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">6.1. Принципы работы с <span class="app">Главным меню</span></span></h2></div>
<div class="region"><div class="contents">
<p class="p"><span class="app">Главное меню</span> сразу после его отображения на экране представляет из себя вертикальный ряд экранных кнопок. Каждая кнопка служит для выбора определенного режима работы ПО.</p>
<div class="figure"><div class="inner">
<a href="#" class="zoom" data-zoom-in-title="View images at normal size" data-zoom-out-title="Scale images down"></a><div class="title title-figure"><h3><span class="title">Главное меню в исходном состоянии</span></h3></div>
<div class="region">
<div class="contents"><div class="media media-image"><div class="inner"><img src="figures_current_theme/main_menu_upmenu.png" class="media media-block" alt=""></div></div></div>
<div class="desc">Вертикальный ряд экранных кнопок <span class="app">Главного меню</span>.</div>
</div>
</div></div>
<p class="p">После нажатия на одну из кнопок включается соответствующий режим работы ПО (например, <span class="link"><a href="operations.html#mode_angle" title="4.3. Режим поворота карты">4.3. Режим поворота карты</a></span> или <span class="link"><a href="operations.html#mode_route" title="4.6. Режим редактирования маршрута">4.6. Режим редактирования маршрута</a></span>), а на месте ряда кнопок <span class="app">Главного меню</span> появляются виджеты соответствующего режима. При этом только что нажатая кнопка перемещается в верхнюю часть экрана, а все остальные кнопки <span class="app">Главного меню</span> исчезают. Рамка перемещенной вверх кнопки выбранного режима подсвечивается красным цветом, повторное нажатие завершит работу ПО в текущем режиме и вернет <span class="app">Главное меню</span> к исходному состоянию.</p>
<div class="figure"><div class="inner">
<a href="#" class="zoom" data-zoom-in-title="View images at normal size" data-zoom-out-title="Scale images down"></a><div class="title title-figure"><h3><span class="title">Главное меню, выбран режим</span></h3></div>
<div class="region">
<div class="contents"><div class="media media-image"><div class="inner"><img src="figures_current_theme/main_menu_angle.png" class="media media-block" alt=""></div></div></div>
<div class="desc">В <span class="app">Главном меню</span> выбран <span class="link"><a href="operations.html#mode_measures" title="4.5. Режим для выполнения измерений">4.5. Режим для выполнения измерений</a></span>, соответственно на экране отображаются виджеты этого режима.</div>
</div>
</div></div>
</div></div>
</div></div>
<div id="slip" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">6.2. Принципы работы с <span class="app">Интерактивным информационным виджетом</span></span></h2></div>
<div class="region"><div class="contents">
<p class="p"><span class="app">Интерактивный информационный виджет</span> предназначен для вывода на экран информации в текстовом виде и позволяет оператору удобно варьировать количество информации, выводимой на экран виджетом в данный момент, а также полностью отключать вывод информации.</p>
<p class="p">По умолчанию <span class="app">Интерактивный информационный виджет</span> выводит на экран одну строку текстовой информации:</p>
<div class="media media-image"><div class="inner"><img src="figures_common/slip_1.png" class="media media-block" alt=""></div></div>
<p class="p">Оператор может изменять размер виджета выделив любую точку на виджете и двигая указатель вверх, либо вниз, изменяя тем самым количество строк информации, выводимых на экран.</p>
<div class="media media-image"><div class="inner"><img src="figures_common/slip_2.png" class="media media-block" alt=""></div></div>
<p class="p">Небольшие черные стрелки в правой и левой частях виджета подсказывают оператору, как в данный момент можно изменить количество выводимых строк информации. Например, если виджет в данный момент выводит на экран максимальное установленное разработчиком ПО количество строк, то оператору доступно только одной действие — уменьшение количества выводимой информации, о чем свидетельствуют черные стрелки, направленные в одну, соответствующую, сторону:</p>
<div class="media media-image"><div class="inner"><img src="figures_common/slip_3.png" class="media media-block" alt=""></div></div>
<p class="p">Движением указателя в сторону уменьшения количества выводимых на экран строк оператор может сократить их количество до нуля. В таком случае на экране будет отображаться пустой предельно компактный <span class="app">Интерактивный информационный виджет</span> с однонаправленными стрелками:</p>
<div class="media media-image"><div class="inner"><img src="figures_common/slip_0.png" class="media media-block" alt=""></div></div>
</div></div>
</div></div>
<div id="gpsd" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">6.3. Преобразование навигационных данных</span></h2></div>
<div class="region">
<div class="contents"></div>
<div id="" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">6.3.1. Принципы работы механизма преобразования навигационных данных</span></h3></div>
<div class="region"><div class="contents">
<p class="p">Получение навигационных данных в ПО <span class="app">ГИС-Платформа</span> реализовано с использованием библиотеки <span class="app">libgps</span>, которая в свою очередь в качестве источника навигационных данных использует системную службу <span class="app">gpsd</span>. Использование библиотеки <span class="app">libgps</span> позволяет ПО <span class="app">ГИС-Платформа</span> работать с большим списком устройств получения навигационных данных, который к тому же постоянно расширяется разработчиками системной службы <span class="app">gpsd</span>.</p>
<p class="p">Однако иногда возникает необходимость в работе с оборудованием, протокол работы с которым не реализован в <span class="app">gpsd</span>. Для работы с такими устройствами в ПО <span class="app">ГИС-Платформа</span> встроен механизм преобразования навигационных данных, который позволяет с помощью подключаемых модулей ("плагинов") осуществить сопряжение нового устройства с системной службой <span class="app">gpsd</span>.</p>
<div class="note" title="Note"><div class="inner"><div class="region"><div class="contents"><p class="p">После сопряжения подключенного к ЭВМ устройства получения навигационных данных с системной службой <span class="app">gpsd</span> данные с устройства становятся доступны не только ПО <span class="app">ГИС-Платформа</span>, но и всем навигационным приложениям, работающим с библиотекой <span class="app">libgps</span>.</p></div></div></div></div>
<p class="p">Прием навигационных данных с подключенного к ЭВМ устройства, конвертация этих данных с помощью алгоритмов, заложенных оператором в плагин, а затем отправка сконвертированных данных по протоколу UDP системной службе <span class="app">gpsd</span> осуществляется в отдельном программном потоке (о настройке параметров работы преобразования навигационных данных см. <span class="link"><a href="preferences.html#gpsd" title="5.3. Страница настроек Преобразование навигационных данных">5.3. Страница настроек <span class="gui">Преобразование навигационных данных</span></a></span>). Плагин осуществляет конвертацию данных из собственного протокола подключенного устройства в универсальный текстовый протокол <span class="link"><a href="http://ru.wikipedia.org/wiki/NMEA_0183" title="http://ru.wikipedia.org/wiki/NMEA_0183">NMEA</a></span>, понятный системной службе <span class="app">gpsd</span>.</p>
</div></div>
</div></div>
<div id="" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">6.3.2. Написание плагинов для преобразования навигационных данных</span></h3></div>
<div class="region"><div class="contents">
<p class="p">Плагин представляет из себя простую разделяемую библиотеку (.so-файл, собранный с помощью <span class="app">GCC</span>, запущенным с параметром <span class="cmd">-shared</span>). Плагин должен содержать функцию с именем <span class="code">convert_data</span> в глобальном пространстве имен. Функция должна иметь вид:</p>
<p class="p">int convert_data(char *inbuf, int insize, char *outbuf, int outsize, int debug_flag);</p>
<p class="p">Функция будет вызываться автоматически программным обеспечением <span class="app">ГИС-Платформа</span> при приеме новой порции данных от подключенного к ЭВМ устройства. В функцию передаются следующие аргументы:</p>
<div class="list"><div class="inner"><div class="region"><ol class="list" style="list-style-type:numbered">
<li class="list"><p class="p"><span class="code">inbuf</span> — указатель на буфер с навигационными данными (в протоколе устройства), полученными от подключенного к ЭВМ устройства</p></li>
<li class="list"><p class="p"><span class="code">insize</span> — размер данных (в байтах) в буфере с навигационными данными, полученными от подключенного к ЭВМ устройства</p></li>
<li class="list"><p class="p"><span class="code">outbuf</span> — указатель на буфер, в который следует положить сконвертированные в протокол NMEA данные</p></li>
<li class="list"><p class="p"><span class="code">outsize</span> — размер буфера (в байтах), в который слудует положить сконвертированные в протокол NMEA данные</p></li>
<li class="list"><p class="p"><span class="code">debug_flag</span> — флаг включения отладочных сообщений плагина (при debug_flag=0 отладочные сообщения должны быть полностью отключены, при ненулевом могут выводится на экран)</p></li>
</ol></div></div></div>
<p class="p">ПО <span class="app">ГИС-Платформа</span> передает в функцию <span class="code">convert_data</span> с помощью буфера по адресу <span class="code">inbuf</span> навигационные данные (в протоколе устройства), полученные с подключенного к ЭВМ устройства. Плагин согласно встроенным в него алгоритмам осуществляет разбор переданных ему данных и конвертацию их в протокол NMEA. Полученные после конвертации данные плагин записывает в буфер по адресу <span class="code">outbuf</span>.</p>
<p class="p">Функция возвращает размер сконвертированных в протокол NMEA данных (в байтах), которые были положены в буфер <span class="code">outbuf</span>.</p>
<p class="p">Память под входной и выходной буферы выделяется ПО <span class="app">ГИС-Платформа</span> самостоятельно, плагин не должен заниматься выделением или освобождением памяти. Плагин должен оценить размер предоставляемого ему под выходные данные буфера и записать в этот буфер сконвертированные данные такого размера, чтобы этот размер не превышал размер буфера.</p>
<p class="p">По умолчанию в функцию  <span class="code">convert_data</span> в качестве аргумента <span class="code">debug_flag</span> передается 0. Чтобы передать в функцию ненулевое значение и, соответсвенно, инициировать включение отладочных сообщений в плагине, следует запустить ПО <span class="app">ГИС-Платформа</span> с соответсвующим параметром (см.  <span class="link"><a href="preparation.html#params" title="2.3. Параметры командной строки">2.3. Параметры командной строки</a></span>).</p>
<p class="p">Скомпилированный файл плагина следует положить в каталог <span class="file">~/.local/lib/gis_platform/gpsd_converter_plugins/</span>. После этого он будет добавлен в список доступных для работы плагинов (см. <span class="link"><a href="preferences.html#gpsd" title="5.3. Страница настроек Преобразование навигационных данных">5.3. Страница настроек <span class="gui">Преобразование навигационных данных</span></a></span>).</p>
</div></div>
</div></div>
</div>
</div></div>
<div id="signature" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">6.4. Цифровая подпись сборки</span></h2></div>
<div class="region"><div class="contents">
<p class="p">Каждому экземпляру программы <span class="app">ГИС-Платформа</span> назначается идентификатор сборки — <span class="app">id</span>. <span class="app">Id</span> содержит подробное описание предназначения конкретной сборки программы (например, <span class="app">id</span> может содержать mac-адрес устройства, на котором будет работать данная сборка ПО, описание боевой машины, информация о договоре поставки и т.п., либо в <span class="app">id</span> может быть описано, что данная сборка вообще не предназначена для продажи, а является демонстрационной сборкой).</p>
<div class="note note-important" title="Important"><div class="inner"><div class="region"><div class="contents"><p class="p"><span class="app">Id</span> описывает предназначение конкретной сборки ПО, но в то же время может быть одинаковым для ряда сборок (в том числе для ПО разных версий) с одинаковым предназначением.</p></div></div></div></div>
<p class="p"><span class="app">Id</span> подписывается цифровой подписью с помощью закрытого ключа (<span class="file">secring.gpg</span>). Закрытый ключ не поставляется заказчику, а доступен только разработчикам ПО.</p>
<p class="p"><span class="app">Id</span> вместе с цифровой подписью встраивается в исполняемый файл <span class="app">ПО ГИС-Платформа</span> на этапе его компиляции. Вывести на экран <span class="app">id</span> конкретной сборки ПО вместе с цифровой подписью можно с помощью параметра командной строки <span class="cmd">--signature</span> (<span class="cmd">-s</span>).</p>
<p class="p">Проверка цифровой подписи <span class="app">id</span> осуществляется с использованием открытого ключа <span class="file">pubring.gpg</span>. Проверка осуществляется с помощью программы <span class="app">gpg</span>: <span class="cmd">gis_platform -s | gpg --verify</span>. Предполагается, что пройденная проверка может рассматриваться как подтверждение (одно из подтверждений) того, что ПО было собрано и поставлено для целей, описанных в <span class="app">id</span> с соблюдением необходимых лицензионных вопросов.</p>
</div></div>
</div></div>
<div id="komponowsky" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">6.5. Сборка карты</span></h2></div>
<div class="region"><div class="contents">
<p class="p"><span class="app">ГИС-Платформа</span> предоставляет функциональность для создания директории, содержащей файлы карт (.SXF и .RSC), а также файл описания .DIR.</p>
<p class="p">Интерфейс для сборки карты вызывается нажатием соответствующей кнопки на окне работы ПО без карты (см. <span class="link"><a href="operations.html#win_main_without_map" title="4.1. Описание окна работы ПО без карты">4.1. Описание окна работы ПО без карты</a></span>).</p>
<div class="figure"><div class="inner">
<a href="#" class="zoom" data-zoom-in-title="View images at normal size" data-zoom-out-title="Scale images down"></a><div class="title title-figure"><h3><span class="title"><span class="link"><a href="#komponowsky" title="6.5. Сборка карты">6.5. Сборка карты</a></span></span></h3></div>
<div class="region"><div class="contents"><div class="media media-image"><div class="inner"><img src="figures_common/komponowsky.png" class="media media-block" alt=""></div></div></div></div>
</div></div>
<p class="p">В интерфейсе, открывшемся после нажатия на кнопку <span class="gui">Собрать карту</span> в поле <span class="gui">Название карты</span> вводится имя создаваемой директоии. Такое же имя будет присвоено файлу описания DIR. Не допускается пустое имя файла. Для быстрой очистки поля ввода предусмотрена  кнопка <span class="gui">Очистить</span>.</p>
<p class="p">Нажатие на кнопку в поле <span class="gui">Классификатор</span> открывает диалог выбора файла RSC. В диалоге действует фильтр имен файлов, поэтому отображаться будут только RSC-файлы, содержащиеся в текущей директории.</p>
<p class="p">Нажатие на кнопку <span class="gui">Добавить</span> открывает диалог выбора файлов SXF. Диалог позволяет проводить множественное выделение файлов. В диалоге действует фильтр имен файлов, поэтому отображаться будут только SXF-файлы, содержащиеся в текущей директории. Нажатие на кнопку <span class="gui">Выделить всё</span> в диалоге выделяет все SXF-файлы текущей директории. Список выбранных SXF-файлов будет отображаться в таблице <span class="gui">Имена файлов</span></p>
<p class="p">Все файлы удаляются из таблицы по нажатию кнопки <span class="gui">Очистить</span>.</p>
<p class="p">Единичные выделенные файлы можно удалять из таблицы нажатием на кнопку <span class="gui">Удалить</span>.</p>
<p class="p">Нажатием кнопки <span class="gui">Экранная клавиатура</span> вызывается экранная клавиатура, позволяющая вводить латинский текст и цифры.</p>
<p class="p">Нажатие кнопки <span class="gui">ОК</span> в окне интерфейса сборки карт создает директорию с именем, указанным в поле <span class="gui">Название карты</span>. В эту директорию копируется выбранный RSC-файл, выбранные SXF-файлы, и в ней создаётся файл DIR. В файле DIR перечислены выбранные SXF-файлы, файл RSC и имя самого DIR файла. Если была установлена галочка <span class="gui">Импорт</span>, то в только что созданной директории будет также создан map-файл с названием, взятым из поля <span class="gui">Название карты</span> и, в сулчае успешного импорта данных, карта будет автоматически отображена на экране.</p>
</div></div>
</div></div>
<div class="sect sect-links" role="navigation">
<div class="hgroup"></div>
<div class="contents"><div class="links guidelinks"><div class="inner">
<div class="title"><h2><span class="title">More Information</span></h2></div>
<div class="region"><ul><li class="links "><a href="index.html" title="ГИС-Платформа">ГИС-Платформа</a></li></ul></div>
</div></div></div>
</div>
</div>
<div class="clear"></div>
</div>
<div class="footer"></div>
</div></body>
</html>
